function cov_5hd6f6iz8(){var path="/home/douglas/Documentos/estudos/promises-generatos-iterators/src/pagination.js";var hash="28aae921064b6ca02499afad536169a8441311c1";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/douglas/Documentos/estudos/promises-generatos-iterators/src/pagination.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:36}},"1":{start:{line:3,column:24},end:{line:8,column:1}},"2":{start:{line:10,column:0},end:{line:73,column:2}},"3":{start:{line:12,column:4},end:{line:12,column:33}},"4":{start:{line:14,column:4},end:{line:14,column:41}},"5":{start:{line:15,column:4},end:{line:15,column:45}},"6":{start:{line:16,column:4},end:{line:16,column:55}},"7":{start:{line:17,column:4},end:{line:17,column:39}},"8":{start:{line:21,column:4},end:{line:42,column:5}},"9":{start:{line:22,column:23},end:{line:22,column:43}},"10":{start:{line:23,column:21},end:{line:27,column:8}},"11":{start:{line:29,column:6},end:{line:29,column:20}},"12":{start:{line:31,column:6},end:{line:34,column:7}},"13":{start:{line:32,column:8},end:{line:32,column:59}},"14":{start:{line:33,column:8},end:{line:33,column:20}},"15":{start:{line:36,column:6},end:{line:38,column:8}},"16":{start:{line:39,column:6},end:{line:39,column:48}},"17":{start:{line:41,column:6},end:{line:41,column:72}},"18":{start:{line:46,column:4},end:{line:46,column:61}},"19":{start:{line:46,column:36},end:{line:46,column:59}},"20":{start:{line:64,column:19},end:{line:64,column:58}},"21":{start:{line:65,column:19},end:{line:65,column:54}},"22":{start:{line:67,column:4},end:{line:67,column:40}},"23":{start:{line:67,column:22},end:{line:67,column:40}},"24":{start:{line:69,column:4},end:{line:69,column:17}},"25":{start:{line:70,column:4},end:{line:70,column:43}},"26":{start:{line:71,column:4},end:{line:71,column:52}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:11,column:2},end:{line:11,column:3}},loc:{start:{line:11,column:41},end:{line:18,column:3}},line:11},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:2},end:{line:20,column:3}},loc:{start:{line:20,column:50},end:{line:43,column:3}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:45,column:2},end:{line:45,column:3}},loc:{start:{line:45,column:25},end:{line:47,column:3}},line:45},"3":{name:"(anonymous_3)",decl:{start:{line:46,column:23},end:{line:46,column:24}},loc:{start:{line:46,column:36},end:{line:46,column:59}},line:46},"4":{name:"(anonymous_4)",decl:{start:{line:63,column:2},end:{line:63,column:3}},loc:{start:{line:63,column:37},end:{line:72,column:3}},line:63}},branchMap:{"0":{loc:{start:{line:11,column:14},end:{line:11,column:39}},type:"default-arg",locations:[{start:{line:11,column:24},end:{line:11,column:39}}],line:11},"1":{loc:{start:{line:20,column:35},end:{line:20,column:46}},type:"default-arg",locations:[{start:{line:20,column:45},end:{line:20,column:46}}],line:20},"2":{loc:{start:{line:31,column:6},end:{line:34,column:7}},type:"if",locations:[{start:{line:31,column:6},end:{line:34,column:7}},{start:{line:31,column:6},end:{line:34,column:7}}],line:31},"3":{loc:{start:{line:65,column:19},end:{line:65,column:54}},type:"binary-expr",locations:[{start:{line:65,column:19},end:{line:65,column:49}},{start:{line:65,column:53},end:{line:65,column:54}}],line:65},"4":{loc:{start:{line:67,column:4},end:{line:67,column:40}},type:"if",locations:[{start:{line:67,column:4},end:{line:67,column:40}},{start:{line:67,column:4},end:{line:67,column:40}}],line:67}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0],"1":[0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"28aae921064b6ca02499afad536169a8441311c1"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_5hd6f6iz8=function(){return actualCoverage;};}return actualCoverage;}cov_5hd6f6iz8();const Request=(cov_5hd6f6iz8().s[0]++,require('./request'));const DEFAULT_OPTIONS=(cov_5hd6f6iz8().s[1]++,{maxRetries:4,retryTimeout:1000,maxRequestTimeout:1000,threshold:200});cov_5hd6f6iz8().s[2]++;module.exports=class Pagination{constructor(options=(cov_5hd6f6iz8().b[0][0]++,DEFAULT_OPTIONS)){cov_5hd6f6iz8().f[0]++;cov_5hd6f6iz8().s[3]++;this.request=new Request();cov_5hd6f6iz8().s[4]++;this.maxRetries=options.maxRetries;cov_5hd6f6iz8().s[5]++;this.retryTimeout=options.retryTimeout;cov_5hd6f6iz8().s[6]++;this.maxRequestTimeout=options.maxRequestTimeout;cov_5hd6f6iz8().s[7]++;this.threshold=options.threshold;}async handleRequest({url,page,retries=(cov_5hd6f6iz8().b[1][0]++,1)}){cov_5hd6f6iz8().f[1]++;cov_5hd6f6iz8().s[8]++;try{const finalUrl=(cov_5hd6f6iz8().s[9]++,`${url}?tid=${page}`);const result=(cov_5hd6f6iz8().s[10]++,await this.request.makeRequest({url:finalUrl,method:'get',timeout:this.maxRequestTimeout}));cov_5hd6f6iz8().s[11]++;return result;}catch(error){cov_5hd6f6iz8().s[12]++;if(retries===this.maxRetries){cov_5hd6f6iz8().b[2][0]++;cov_5hd6f6iz8().s[13]++;console.error(`[${retries}] max retries reached!`);cov_5hd6f6iz8().s[14]++;throw error;}else{cov_5hd6f6iz8().b[2][1]++;}cov_5hd6f6iz8().s[15]++;console.error(`[${retries}] an error: [${error.message}] has happened! Trying again in ${this.retryTimeout}ms`);cov_5hd6f6iz8().s[16]++;await Pagination.sleep(this.retryTimeout);cov_5hd6f6iz8().s[17]++;return this.handleRequest({url,page,retries:retries+=1});}}static async sleep(ms){cov_5hd6f6iz8().f[2]++;cov_5hd6f6iz8().s[18]++;return new Promise(resolve=>{cov_5hd6f6iz8().f[3]++;cov_5hd6f6iz8().s[19]++;return setTimeout(resolve,ms);});}/*
    Generators sao usados pra trabalhar com dados sob demanda
    precisamos anotas a funcao com * e usar o yield para retornar dados sob demanda
    quando usamos o yield { 0 }

    O retorno pode ser { done: false, value: 0 }
    const r = getPaginated()
    r.next() -> { done: false, value: 0 }
    r.next() -> { done: true, value: 0 }

    quando queremos delegar uma execucao (nao retornar valor, delegar!)
    yield* funcao
  */async*getPaginated({url,page}){cov_5hd6f6iz8().f[4]++;const result=(cov_5hd6f6iz8().s[20]++,await this.handleRequest({url,page}));const lastId=(cov_5hd6f6iz8().s[21]++,(cov_5hd6f6iz8().b[3][0]++,result[result.length-1]?.tid)??(cov_5hd6f6iz8().b[3][1]++,0));// se result[index] der undefined, nao verifica a prop tid e passa o valor 0 pra const
// CUIDADO, mais de 1M de requisicoes
cov_5hd6f6iz8().s[22]++;if(lastId===0){cov_5hd6f6iz8().b[4][0]++;cov_5hd6f6iz8().s[23]++;return['result'];}else{cov_5hd6f6iz8().b[4][1]++;}cov_5hd6f6iz8().s[24]++;yield result;cov_5hd6f6iz8().s[25]++;await Pagination.sleep(this.threshold);cov_5hd6f6iz8().s[26]++;yield*this.getPaginated({url,page:lastId});}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhZ2luYXRpb24uanMiXSwibmFtZXMiOlsiUmVxdWVzdCIsInJlcXVpcmUiLCJERUZBVUxUX09QVElPTlMiLCJtYXhSZXRyaWVzIiwicmV0cnlUaW1lb3V0IiwibWF4UmVxdWVzdFRpbWVvdXQiLCJ0aHJlc2hvbGQiLCJtb2R1bGUiLCJleHBvcnRzIiwiUGFnaW5hdGlvbiIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInJlcXVlc3QiLCJoYW5kbGVSZXF1ZXN0IiwidXJsIiwicGFnZSIsInJldHJpZXMiLCJmaW5hbFVybCIsInJlc3VsdCIsIm1ha2VSZXF1ZXN0IiwibWV0aG9kIiwidGltZW91dCIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJzbGVlcCIsIm1zIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZ2V0UGFnaW5hdGVkIiwibGFzdElkIiwibGVuZ3RoIiwidGlkIl0sIm1hcHBpbmdzIjoidzdIQWVZO3lGQWZaLEtBQU1BLENBQUFBLE9BQU8seUJBQUdDLE9BQU8sQ0FBQyxXQUFELENBQVYsQ0FBYixDQUVBLEtBQU1DLENBQUFBLGVBQWUseUJBQUcsQ0FDdEJDLFVBQVUsQ0FBRSxDQURVLENBRXRCQyxZQUFZLENBQUUsSUFGUSxDQUd0QkMsaUJBQWlCLENBQUUsSUFIRyxDQUl0QkMsU0FBUyxDQUFFLEdBSlcsQ0FBSCxDQUFyQixDLHVCQU9BQyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsS0FBTUMsQ0FBQUEsVUFBVyxDQUNoQ0MsV0FBVyxDQUFDQyxPQUFPLDRCQUFHVCxlQUFILENBQVIsQ0FBNEIsK0NBQ3JDLEtBQUtVLE9BQUwsQ0FBZSxHQUFJWixDQUFBQSxPQUFKLEVBQWYsQ0FEcUMsdUJBR3JDLEtBQUtHLFVBQUwsQ0FBa0JRLE9BQU8sQ0FBQ1IsVUFBMUIsQ0FIcUMsdUJBSXJDLEtBQUtDLFlBQUwsQ0FBb0JPLE9BQU8sQ0FBQ1AsWUFBNUIsQ0FKcUMsdUJBS3JDLEtBQUtDLGlCQUFMLENBQXlCTSxPQUFPLENBQUNOLGlCQUFqQyxDQUxxQyx1QkFNckMsS0FBS0MsU0FBTCxDQUFpQkssT0FBTyxDQUFDTCxTQUF6QixDQUNELENBRWtCLEtBQWJPLENBQUFBLGFBQWEsQ0FBQyxDQUFFQyxHQUFGLENBQU9DLElBQVAsQ0FBYUMsT0FBTyw0QkFBRyxDQUFILENBQXBCLENBQUQsQ0FBNkIsK0NBQzlDLEdBQUksQ0FDRixLQUFNQyxDQUFBQSxRQUFRLHlCQUFJLEdBQUVILEdBQUksUUFBT0MsSUFBSyxFQUF0QixDQUFkLENBQ0EsS0FBTUcsQ0FBQUEsTUFBTSwwQkFBRyxLQUFNLE1BQUtOLE9BQUwsQ0FBYU8sV0FBYixDQUF5QixDQUM1Q0wsR0FBRyxDQUFFRyxRQUR1QyxDQUU1Q0csTUFBTSxDQUFFLEtBRm9DLENBRzVDQyxPQUFPLENBQUUsS0FBS2hCLGlCQUg4QixDQUF6QixDQUFULENBQVosQ0FGRSx3QkFRRixNQUFPYSxDQUFBQSxNQUFQLENBQ0QsQ0FBQyxNQUFPSSxLQUFQLENBQWMseUJBQ2QsR0FBSU4sT0FBTyxHQUFLLEtBQUtiLFVBQXJCLENBQWlDLG1EQUMvQm9CLE9BQU8sQ0FBQ0QsS0FBUixDQUFlLElBQUdOLE9BQVEsd0JBQTFCLEVBRCtCLHdCQUUvQixLQUFNTSxDQUFBQSxLQUFOLENBQ0QsQ0FIRCxnQ0FEYyx3QkFNZEMsT0FBTyxDQUFDRCxLQUFSLENBQ0csSUFBR04sT0FBUSxnQkFBZU0sS0FBSyxDQUFDRSxPQUFRLG1DQUFrQyxLQUFLcEIsWUFBYSxJQUQvRixFQU5jLHdCQVNkLEtBQU1LLENBQUFBLFVBQVUsQ0FBQ2dCLEtBQVgsQ0FBaUIsS0FBS3JCLFlBQXRCLENBQU4sQ0FUYyx3QkFXZCxNQUFPLE1BQUtTLGFBQUwsQ0FBbUIsQ0FBRUMsR0FBRixDQUFPQyxJQUFQLENBQWFDLE9BQU8sQ0FBR0EsT0FBTyxFQUFJLENBQWxDLENBQW5CLENBQVAsQ0FDRCxDQUNGLENBRWlCLFlBQUxTLENBQUFBLEtBQUssQ0FBQ0MsRUFBRCxDQUFLLGdEQUNyQixNQUFPLElBQUlDLENBQUFBLE9BQUosQ0FBYUMsT0FBRCxFQUFhLHNEQUFBQyxDQUFBQSxVQUFVLENBQUNELE9BQUQsQ0FBVUYsRUFBVixDQUFWLENBQXVCLENBQWhELENBQVAsQ0FDRCxDQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBRXFCLE1BQVpJLFlBQVksQ0FBQyxDQUFFaEIsR0FBRixDQUFPQyxJQUFQLENBQUQsQ0FBZ0Isd0JBQ2pDLEtBQU1HLENBQUFBLE1BQU0sMEJBQUcsS0FBTSxNQUFLTCxhQUFMLENBQW1CLENBQUVDLEdBQUYsQ0FBT0MsSUFBUCxDQUFuQixDQUFULENBQVosQ0FDQSxLQUFNZ0IsQ0FBQUEsTUFBTSwwQkFBRywyQkFBQWIsTUFBTSxDQUFDQSxNQUFNLENBQUNjLE1BQVAsQ0FBZ0IsQ0FBakIsQ0FBTixFQUEyQkMsR0FBM0IsOEJBQWtDLENBQWxDLENBQUgsQ0FBWixDQUFvRDtBQUNwRDtBQUhpQyx3QkFJakMsR0FBSUYsTUFBTSxHQUFLLENBQWYsQ0FBa0IseURBQU8sQ0FBQyxRQUFELENBQVAsQ0FBa0IsQ0FBcEMsZ0NBSmlDLHdCQU1qQyxLQUFNYixDQUFBQSxNQUFOLENBTmlDLHdCQU9qQyxLQUFNVCxDQUFBQSxVQUFVLENBQUNnQixLQUFYLENBQWlCLEtBQUtuQixTQUF0QixDQUFOLENBUGlDLHdCQVFqQyxNQUFPLEtBQUt3QixZQUFMLENBQWtCLENBQUVoQixHQUFGLENBQU9DLElBQUksQ0FBRWdCLE1BQWIsQ0FBbEIsQ0FBUCxDQUNELENBOUQrQixDQUFsQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFJlcXVlc3QgPSByZXF1aXJlKCcuL3JlcXVlc3QnKTtcblxuY29uc3QgREVGQVVMVF9PUFRJT05TID0ge1xuICBtYXhSZXRyaWVzOiA0LFxuICByZXRyeVRpbWVvdXQ6IDEwMDAsXG4gIG1heFJlcXVlc3RUaW1lb3V0OiAxMDAwLFxuICB0aHJlc2hvbGQ6IDIwMCxcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgUGFnaW5hdGlvbiB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSBERUZBVUxUX09QVElPTlMpIHtcbiAgICB0aGlzLnJlcXVlc3QgPSBuZXcgUmVxdWVzdCgpO1xuXG4gICAgdGhpcy5tYXhSZXRyaWVzID0gb3B0aW9ucy5tYXhSZXRyaWVzO1xuICAgIHRoaXMucmV0cnlUaW1lb3V0ID0gb3B0aW9ucy5yZXRyeVRpbWVvdXQ7XG4gICAgdGhpcy5tYXhSZXF1ZXN0VGltZW91dCA9IG9wdGlvbnMubWF4UmVxdWVzdFRpbWVvdXQ7XG4gICAgdGhpcy50aHJlc2hvbGQgPSBvcHRpb25zLnRocmVzaG9sZDtcbiAgfVxuXG4gIGFzeW5jIGhhbmRsZVJlcXVlc3QoeyB1cmwsIHBhZ2UsIHJldHJpZXMgPSAxIH0pIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmluYWxVcmwgPSBgJHt1cmx9P3RpZD0ke3BhZ2V9YDtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucmVxdWVzdC5tYWtlUmVxdWVzdCh7XG4gICAgICAgIHVybDogZmluYWxVcmwsXG4gICAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICAgIHRpbWVvdXQ6IHRoaXMubWF4UmVxdWVzdFRpbWVvdXQsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKHJldHJpZXMgPT09IHRoaXMubWF4UmV0cmllcykge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtyZXRyaWVzfV0gbWF4IHJldHJpZXMgcmVhY2hlZCFgKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIGBbJHtyZXRyaWVzfV0gYW4gZXJyb3I6IFske2Vycm9yLm1lc3NhZ2V9XSBoYXMgaGFwcGVuZWQhIFRyeWluZyBhZ2FpbiBpbiAke3RoaXMucmV0cnlUaW1lb3V0fW1zYFxuICAgICAgKTtcbiAgICAgIGF3YWl0IFBhZ2luYXRpb24uc2xlZXAodGhpcy5yZXRyeVRpbWVvdXQpO1xuXG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVSZXF1ZXN0KHsgdXJsLCBwYWdlLCByZXRyaWVzOiAocmV0cmllcyArPSAxKSB9KTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgc2xlZXAobXMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgfVxuXG4gIC8qXG4gICAgR2VuZXJhdG9ycyBzYW8gdXNhZG9zIHByYSB0cmFiYWxoYXIgY29tIGRhZG9zIHNvYiBkZW1hbmRhXG4gICAgcHJlY2lzYW1vcyBhbm90YXMgYSBmdW5jYW8gY29tICogZSB1c2FyIG8geWllbGQgcGFyYSByZXRvcm5hciBkYWRvcyBzb2IgZGVtYW5kYVxuICAgIHF1YW5kbyB1c2Ftb3MgbyB5aWVsZCB7IDAgfVxuXG4gICAgTyByZXRvcm5vIHBvZGUgc2VyIHsgZG9uZTogZmFsc2UsIHZhbHVlOiAwIH1cbiAgICBjb25zdCByID0gZ2V0UGFnaW5hdGVkKClcbiAgICByLm5leHQoKSAtPiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogMCB9XG4gICAgci5uZXh0KCkgLT4geyBkb25lOiB0cnVlLCB2YWx1ZTogMCB9XG5cbiAgICBxdWFuZG8gcXVlcmVtb3MgZGVsZWdhciB1bWEgZXhlY3VjYW8gKG5hbyByZXRvcm5hciB2YWxvciwgZGVsZWdhciEpXG4gICAgeWllbGQqIGZ1bmNhb1xuICAqL1xuXG4gIGFzeW5jICpnZXRQYWdpbmF0ZWQoeyB1cmwsIHBhZ2UgfSkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuaGFuZGxlUmVxdWVzdCh7IHVybCwgcGFnZSB9KTtcbiAgICBjb25zdCBsYXN0SWQgPSByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDFdPy50aWQgPz8gMDsgLy8gc2UgcmVzdWx0W2luZGV4XSBkZXIgdW5kZWZpbmVkLCBuYW8gdmVyaWZpY2EgYSBwcm9wIHRpZCBlIHBhc3NhIG8gdmFsb3IgMCBwcmEgY29uc3RcbiAgICAvLyBDVUlEQURPLCBtYWlzIGRlIDFNIGRlIHJlcXVpc2ljb2VzXG4gICAgaWYgKGxhc3RJZCA9PT0gMCkgcmV0dXJuIFsncmVzdWx0J107XG5cbiAgICB5aWVsZCByZXN1bHQ7XG4gICAgYXdhaXQgUGFnaW5hdGlvbi5zbGVlcCh0aGlzLnRocmVzaG9sZCk7XG4gICAgeWllbGQqIHRoaXMuZ2V0UGFnaW5hdGVkKHsgdXJsLCBwYWdlOiBsYXN0SWQgfSk7XG4gIH1cbn07XG4iXX0=